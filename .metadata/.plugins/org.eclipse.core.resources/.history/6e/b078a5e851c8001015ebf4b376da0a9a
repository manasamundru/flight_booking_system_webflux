package com.flightapp.services;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.flightapp.dto.FlightSearchRequest;
import com.flightapp.entities.Flights;
import com.flightapp.repositories.AirlineRepository;
import com.flightapp.repositories.FlightRepository;

import reactor.core.publisher.Flux;
import reactor.core.publisher.Mono;

@Service
public class FlightService {
	@Autowired
	private FlightRepository flightrepo;
	@Autowired
	private AirlineRepository airlineRepo;
	public Mono<String> addInventory(Flights flight) {
		return airlineRepo.findById(flight.getAirlineId())
				.switchIfEmpty(Mono.error(new RuntimeException("Airline not found: " + flight.getAirlineId())))
				.flatMap(a -> flightrepo.save(flight)).map(saved -> saved.getId());
	}
	public Flux<Flights> searchFlights(FlightSearchRequest req) {
        return flightrepo.findByFromPlaceAndToPlaceAndJourneyDate(
                req.getFromPlace(),
                req.getToPlace(),
                req.getJourneyDate()
        );
    }
}
